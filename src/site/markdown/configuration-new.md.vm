#set($h1 = '#')
#set($h2 = '##')
#set($h3 = '###')
#set($h4 = '####')

$h1 Configuration

$h2 Overview

Topcat is configured in two main places:

  * **the backend** - i.e. files which topcat server reads/uses
  * **the frontend** - i.e. files which the browser reads/uses

$h3 Backend configuration


The backend configuration consists of two files:

  * **topcat-setup.properties** - used to configure the application container e.g. database connection and mail server etc...
  * **topcat.properties** - used to configure Topcat (application) specific settings e.g. email messages or IDS polling intervals.

$h3 Frontend configuration

The frontend configuration consists of three files:

  * **topcat.json** - used to configure the structure and behaviour of the frontend e.g. grid columns and ICAT data hierarchy.
  * **lang.json** - used to changed the words on topcat; either the actual language e.g. from English to French, or to substitute words that make more sense to your facility e.g. "Investigator" to "Scientist"
  * **topcat.css** - allows you to change Topcat's styling the page colours etc...

$h2 topcat-setup.properties

Note: '#'s are comments.

```
  # Derby Database Properties
  #driver=org.apache.derby.jdbc.ClientDataSource
  #dbProperties=Password=APP:User=APP:serverName=localhost:DatabaseName=topcat:connectionAttributes=";"create"'"="'"true

  # MySQL Database Properties
  driver=com.mysql.jdbc.jdbc2.optional.MysqlDataSource
  dbProperties=user=root:password=secret:databaseName=topcat

  # Oracle Database Properties
  #driver=oracle.jdbc.pool.OracleDataSource
  #dbProperties=url="jdbc:oracle:thin:@//localhost:1521/XE":ImplicitCachingEnabled=true:MaxStatements=200:user=topcat:password=secret

  # Glassfish home, must contain "glassfish/domains"
  glassfish=/opt/glassfish4

  # Glassfish admin port (default 4848)
  port=4848

  #url root context where topcat will be deployed. use / for root context or enter your required url but do not end with /
  topcatUrlRoot=/

  # Email setup see http://docs.oracle.com/cd/E26576_01/doc.312/e24938/create-javamail-resource.htm#GSRFM00035
  #the smtp host address
  mail.host=smtp.example.com

  #name of mail acount user when connecting to the mail server
  mail.user=user@example.com

  #mail from address
  mail.from=no-reply@example.com

  #see https://javamail.java.net/nonav/docs/api/ for list of properties
  mail.property=mail.smtp.port="25":mail.smtp.from="no-reply@example.com"
```

$h2 topcat.properties

Note: '#'s are comments.

```
  # enable send email
  mail.enable=true

  # The email subject. Tokens available are:
  # ${userName} - user username
  # ${email} - user email
  # ${facilityName} - the facility key (defined in frontend config)
  # ${preparedId} - the prepared Id of the download request
  # ${fileName} - the download name
  # ${downloadUrl} - the download url
  mail.subject=TopCAT Download ${fileName} Completed

  # The email body message for https downloads. All subject tokens as above are available.
  mail.body.https=Hi ${userName},\n\nYour download ${fileName} has completed and ready for download at ${downloadUrl}.\n\nThank you for using TopCAT.

  # The email body message for https downloads. All subject tokens as above are available.
  mail.body.globus=Hi ${userName}, \n\nYour Globus download ${fileName} is ready. Please see https:/example.com/#/globus-faq for more information on how to download using Globus.\n\nThanks you for using TopCAT

  # The email body message for smartclient downloads. All subject tokens as above are available.
  mail.body.smartclient=Hi ${userName}, \n\nYour SmartClient download ${fileName} is ready. Please check your smartclient home directory for your files.\n\nThanks you for using TopCAT

  # The maximum number of datafiles for a getStatus call to the IDS for two level storage
  ids.getStatus.max=100

  # The delay in seconds before polling starts. This delay is to gives the ids a chance to do its thing before we query it
  poll.delay=600

  # The wait time in seconds between each poll to the IDS.
  poll.interval.wait=600

  # A list of usernames that can use the admin REST API and Topcat admin user interface
  adminUserNames=simple/root, uows/elz087, asd345, ldap/fgh123
```

$h2 topcat.json

$h3 High level overview

A high level overview of the topcat.json file is as follows:

```
  {
    "site": {...},
    "facilities": {...}
  }
```

from the above example there are two namespaces defined: 

  * "site" - configures anything anything global across facilities e.g. the cart, information pages or branding etc.
  * "facilities" - configures anything specific to a facility e.g. authentication, column headings or download transport (i.e. delivery) methods.

$h3 Medium level overview

If we expand the namespaces in high level overview we can get a medium overview as follows:

```
  {    
      "site": {
          "topcatApiPath": "https://example.com/api/v1",
          "home" : "my-data",
          "enableEuCookieLaw" : true,
          "paging" : {...},
          "breadcrumb": {...},
          "serviceStatus": {...},
          "maintenanceMode": {...},
          "search": {...},
          "browse":{...},
          "cart":{...},
          "myDownloads":{...},
          "pages" : [...]
      },
      "facilities": {
          "dls": {
              "facilityDatabaseName": "DIAMOND",
              "facilityName": "dls",
              "title": "Diamond Light Source",
              "icatUrl": "https://example.com",
              "idsUrl": "https://example.com",
              "hierarchy": [...],
              "authenticationTypes": [...],
              "downloadTransportTypes": [...],
              "admin":{...},
              "myData": {...},
              "browse":{...}
          }
      }
  }
```

from the above following namespaces defined: 

  * "site"
      * "topcatApiPath" - the path to a valid Topcat REST API.
      * "home" - the section the user gets redirected to after logging in can be "my-data", "browse" or "search"
      * "enableEuCookieLaw" - will show a cookie policy banner which the user can dismiss.
      * "paging" - specifies the paging type configuration i.e. for either paged or infinite scroll
      * "breadcrumb" - specifies global breadcrumb options
      * "serviceStatus" - allows the displaying of a message that the user can dismiss and then carry on using the system.
      * "maintenanceMode" - allows the displaying of a message that the user can't dismiss, and disables the frontend interface i.e. the user can't do anything.
      * "search" - 
      * "browse"
      * "cart"
      * "pages"
  * "facilities"
      * "dls"
          * "facilityDatabaseName"
          * "facilityName"
          * "title"
          * "icatUrl"
          * "idsUrl"
          * "authenticationTypes"
          * "downloadTransportTypes"
          * "admin"
          * "myData"
          * "browse"

$h2 lang.json 

$h2 topcat.css
